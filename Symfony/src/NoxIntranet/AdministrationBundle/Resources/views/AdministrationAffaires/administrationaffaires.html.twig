{% extends "::layout.html.twig" %}

{% block titrePage %} Administration assistant d'affaires {% endblock %}

{% block messageAccueil %}Administration assistant d'affaires{% endblock %}

{% block contenu %}

    <div id="DivChoixActionInfo" style='width: 70%; margin: auto; text-align: center; margin-bottom: 2%;'>
        <div style='display: inline-block; width: 33.33%; text-align: center;'>
            <button type="button" name='profils' class='boutonFormulaire' style='font-size: 0.9vw;'>Profils</button>
        </div><!--
        --><div style='display: inline-block; width: 33.33%; text-align: center;'>
            <button type="button" name='champs' class='boutonFormulaire' style='font-size: 0.9vw;'>Champs</button>
        </div><!--
        --><div style='display: inline-block; width: 33.33%; text-align: center;'>
            <button type="button" name='modeles' class='boutonFormulaire' style='font-size: 0.9vw;'>Modèles</button>
        </div>
    </div>

    <div id='DivProfils' style='display: none;'>

        <div id='DivFormulaireAjoutProfil' class='formulaireAA'>

            {{ form_start(formAjoutProfil, {'attr': {'class': 'formulaireAdministrationAjoutProfil'}}) }}
            {{ form_errors(formAjoutProfil) }}

            <fieldset>

                <legend>Ajouter un profil</legend>

                {{ form_label(formAjoutProfil.Nom, "Nom :", {'label_attr': {'class': 'labelFormulaireAdministrationAjoutProfil'}}) }}
                {{ form_errors(formAjoutProfil.Nom) }}
                {{ form_widget(formAjoutProfil.Nom, {'attr': {'class': 'textFormulaireAdministrationAjoutProfil'}}) }}

                {{ form_widget(formAjoutProfil._token) }}

                {{ form_widget(formAjoutProfil.Ajouter, {'attr': {'class': 'submitFormulaireAdministrationAjoutProfil', 'class': 'boutonFormulaire' }}) }}

            </fieldset>

            {{ form_end(formAjoutProfil) }}

        </div>

        <div id='DivFormulaireSuppressionProfil' class='formulaireAA'>

            {{ form_start(formSuppresionProfil, {'attr': {'class': 'formulaireAdministrationSuppressionProfil'}}) }}
            {{ form_errors(formSuppresionProfil) }}

            <fieldset>

                <legend>Supprimer un profil</legend>

                {{ form_label(formSuppresionProfil.Nom, "Nom :", {'label_attr': {'class': 'labelFormulaireAdministrationSuppressionProfil'}}) }}
                {{ form_errors(formSuppresionProfil.Nom) }}
                {{ form_widget(formSuppresionProfil.Nom, {'attr': {'class': 'selectFormulaireAdministrationSuppressionProfil'}}) }}

                {{ form_widget(formSuppresionProfil._token) }}

                {{ form_widget(formSuppresionProfil.Supprimer, {'attr': {'class': 'submitFormulaireAdministrationSuppressionProfil', 'class': 'boutonFormulaire' }}) }}

            </fieldset> 

            {{ form_end(formSuppresionProfil) }}

        </div>

    </div>

    <div id='DivChamps' style='display: none;'>

        <div class='DivFormulaireAjoutChamp formulaireAA'>

            {{ form_start(formAjoutChamp, {'attr': {'class': 'formulaireAjoutChamp'}}) }}
            {{ form_errors(formAjoutChamp) }}

            <fieldset>

                <legend>Ajouter un champ</legend>

                <div style='width: 70%; margin: auto;'>
                    {{ form_label(formAjoutChamp.Type, "Type :", {'label_attr': {'class': 'labelFormulaireAjoutChamp'}}) }}
                    {{ form_errors(formAjoutChamp.Type) }}
                    {{ form_widget(formAjoutChamp.Type, {'attr': {'class': 'selectFormulaireAjoutChamp champFormulaireAjoutChamp' }}) }}

                    <br />

                    {{ form_widget(formAjoutChamp._token) }}

                    {{ form_label(formAjoutChamp.Nom, "Nom :", {'label_attr': {'class': 'labelFormulaireAjoutChamp'}}) }}
                    {{ form_errors(formAjoutChamp.Nom) }}
                    {{ form_widget(formAjoutChamp.Nom, {'attr': {'class': 'texteFormulaireAjoutChamp champFormulaireAjoutChamp' }}) }}

                    <br />

                    <div style='display: none; vertical-align: middle; margin: 1% 0% 2% 0%;'>
                        <span style='display: inline-block; width: 90%; vertical-align: middle;'> 
                            {{ form_label(formAjoutChamp.AjoutDonnees, "Permettre l'ajout de donnée supplémentaire par l'utilisateur") }}
                            {{ form_errors(formAjoutChamp.AjoutDonnees) }}
                        </span><!--
                        --><span style='display: inline-block; width: 10%; vertical-align: middle;'>
                            {{ form_widget(formAjoutChamp.AjoutDonnees, {'attr': {'class': 'checkboxFormulaireAjoutChamp' }}) }}
                        </span>
                    </div>

                    {{ form_label(formAjoutChamp.Profil, "Profil :", {'label_attr': {'class': 'labelFormulaireAjoutChamp'}}) }}
                    {{ form_errors(formAjoutChamp.Profil) }}
                    {{ form_widget(formAjoutChamp.Profil, {'attr': {'class': 'selectFormulaireAjoutChamp champFormulaireAjoutChamp' }}) }}

                    <br />

                    {{ form_widget(formAjoutChamp.Ajouter, {'attr': {'class': 'submitFormulaireAjoutChamp', 'class': 'boutonFormulaire', 'style': 'margin-top: 1%;' }}) }}
                </div>

            </fieldset> 

            {{ form_end(formAjoutChamp) }}

        </div>

        <div class='DivFormulaireSuppressionChamp formulaireAA'>

            {{ form_start(formSuppressionChamp, {'attr': {'class': 'formulaireSuppressionChamp'}}) }}
            {{ form_errors(formSuppressionChamp) }}

            <fieldset>

                <legend>Supprimer un champ</legend>       

                <p style="width: 70%; margin: auto;">
                    {{ form_label(formSuppressionChamp.Nom, "Nom - Type - Profil", {'label_attr': {'class': 'labelFormulaireSuppressionChamp'}}) }} <br />
                    {{ form_errors(formSuppressionChamp.Nom) }}
                    {{ form_widget(formSuppressionChamp.Nom, {'attr': {'class': 'selectFormulaireSuppressionChamp' }}) }}
                </p>

                <p style="width: 70%; margin: auto; margin-top: 1%;">
                    {{ form_widget(formSuppressionChamp._token) }} 

                    {{ form_widget(formSuppressionChamp.Supprimer, {'attr': {'class': 'submitFormulaireSuppressionChamp', 'class': 'boutonFormulaire' }}) }}
                </p>

            </fieldset> 

            {{ form_end(formSuppressionChamp) }}

        </div>

        <div class='DivFormulaireSelectionChamp formulaireAA'>

            {{ form_start(formSelectionChamp, {'attr': {'class': 'formulaireSelectionChamp'}}) }}
            {{ form_errors(formSelectionChamp) }}

            <fieldset>

                <legend>Editer un champ de données</legend>       

                <p style="width: 70%; margin: auto;">
                    {{ form_label(formSelectionChamp.Champs, "Champ :", {'label_attr': {'class': 'labelFormulaireSelectionChamp'}}) }}
                    {{ form_errors(formSelectionChamp.Champs) }}
                    {{ form_widget(formSelectionChamp.Champs, {'attr': {'class': 'selectFormulaireSelectionChamp' }}) }}
                </p>

                <p style="width: 70%; margin: auto; margin-top: 1%;">
                    {{ form_widget(formSelectionChamp._token) }} 

                    {{ form_widget(formSelectionChamp.Editer, {'attr': {'class': 'submitFormulaireSelectionChamp', 'class': 'boutonFormulaire' }}) }}
                </p>

            </fieldset> 

            {{ form_end(formSelectionChamp) }}

        </div>

    </div>

    <div id='DivModeles' style='display: none;'>

        <div class='DivFormulaireAjoutFichier formulaireAA'>

            {{ form_start(formAjoutFichier, {'attr': {'class': 'formulaireAjoutFichier'}}) }}
            {{ form_errors(formAjoutFichier) }}

            <fieldset>

                <p>
                    {{ form_label(formAjoutFichier.Profil, "Profil :", {'label_attr': {'class': 'labelFormulaireAjoutFichier'}}) }}
                    {{ form_errors(formAjoutFichier.Profil) }}
                    {{ form_widget(formAjoutFichier.Profil, {'attr': {'class': 'fileFormulaireAjoutFichier' }}) }}
                </p>

                <legend>Ajouter un fichier</legend>

                <p>
                    {{ form_errors(formAjoutFichier.file) }}
                    {{ form_widget(formAjoutFichier.file, {'attr': {'class': 'fileFormulaireAjoutFichier', 'style': 'font-size: 0.8vw;' }}) }}

                    {{ form_widget(formAjoutFichier._token) }} <br /><br />

                    {{ form_widget(formAjoutFichier.Ajouter, {'attr': {'class': 'boutonFormulaire' }}) }}
                </p>

            </fieldset> 

            {{ form_end(formAjoutFichier) }}

        </div>

        <div id='DivFormulaireSelectionDossier' class="formulaireAA">

            {{ form_start(formSelectionDossier, {'attr': {'class': 'formulaireSelectionDossier'}}) }}
            {{ form_errors(formSelectionDossier) }}

            <fieldset>

                <legend>Profil</legend>

                {{ form_label(formSelectionDossier.profil, "Selection du profil :", {'label_attr': {'class': 'labelFormulaireSelectionDossier'}}) }}
                {{ form_errors(formSelectionDossier.profil) }}
                {{ form_widget(formSelectionDossier.profil, {'attr': {'class': 'selectFormulaireSelectionDossier'}}) }}

            </fieldset>

            {{ form_end(formSelectionDossier) }}

        </div>

        <div id='DivFormulaireSelectionVersion' class="formulaireAA">
            {{ form_start(formSelectionVersion, {'attr': {'class': 'formulaireSelectionVersion'}}) }}
            {{ form_errors(formSelectionVersion) }}

            <fieldset>

                <legend>Selection du modèle</legend>

                <p>
                    <label for="rechercheSuivi">Recherche</label>
                    <input placeholder="Ex : Ventes 2016" type="text" id="rechercheSuivi" style="width: 100%;"/>
                    {{ form_errors(formSelectionVersion.Suivi) }}
                    {{ form_widget(formSelectionVersion.Suivi, {'attr': {'class': 'selectFormulaireSelectionVersion', 'size': 15}}) }}
                </p>

                {{ form_widget(formSelectionVersion._token) }}

                <p>
                    {{ form_widget(formSelectionVersion.Editer, {'attr': {'class': 'submitFormulaireSelectionVersion' }}) }}
                    {{ form_widget(formSelectionVersion.Supprimer, {'attr': {'class': 'submitFormulaireSelectionVersion' }}) }}
                </p>

            </fieldset>

            {{ form_end(formSelectionVersion) }}

        </div>

    </div>

    <script>

        $(window).load(function () {
            selectInterlocuteurAction();
            toggleCheckboxAjoutDonnees();
            searchSuivi('#rechercheSuivi', '.selectFormulaireSelectionVersion');
        });

        // Affiche/Cache les 'div' de profils/Champs/Modèles.
        function selectInterlocuteurAction() {
            // Lors d'un clique sur le bouton de profils.
            $("button[name='profils']").click(function () {
                $('#DivProfils').show(); // Affiche la 'div' de profils.
                $('#DivChamps').hide(); // Cache la 'div' de champs.
                $('#DivModeles').hide(); // Cache la 'div' de modèles.
            });
            // Lors d'un clique sur le bouton de champs.
            $("button[name='champs']").click(function () {
                $('#DivProfils').hide(); // Affiche la 'div' de profils.
                $('#DivChamps').show(); // Cache la 'div' de champs.
                $('#DivModeles').hide(); // Cache la 'div' de modèles.
            });
            // Lors d'un clique sur le bouton de modèles.
            $("button[name='modeles']").click(function () {
                $('#DivProfils').hide(); // Affiche la 'div' de profils.
                $('#DivChamps').hide(); // Cache la 'div' de champs.
                $('#DivModeles').show(); // Cache la 'div' de modèles.
            });
        }

        // Affiche cache la 'checkbox' d'ajout de données supplémentaire par l'utilisateur en fonction du type de champ séléctionné.
        function toggleCheckboxAjoutDonnees() {
            $('#formAjoutChamp_Type').change(function () {
                // Si le type de champ séléctioné est 'Données'.
                if ($('#formAjoutChamp_Type option:selected').text() === 'Données') {
                    $('#checkboxBR').remove();
                    $('#formAjoutChamp_AjoutDonnees').closest('div').after("<br id='checkboxBR'>");
                    $('#formAjoutChamp_AjoutDonnees').closest('div').css('display', 'inline-block');
                    $('#formAjoutChamp_AjoutDonnees').attr('required', 'required');
                }
                // Si le type de champ séléctioné n'est pas 'Données'.
                else {
                    $('#formAjoutChamp_AjoutDonnees').closest('div').hide();
                    $('#checkboxBR').remove();
                    $('#formAjoutChamp_AjoutDonnees').removeAttr('required');
                }
            });
        }

        // Affiche les suivis selon le nom recherché.
        function searchSuivi(champRecherche, selecteur) {

            // Initialisation d'un timer pour executer la fonction après 1 seconde sans frappe.
            var typewatch = (function () {
                var timer = 0;
                return function (callback, ms) {
                    clearTimeout(timer);
                    timer = setTimeout(callback, ms);
                };
            })();

            // Lorsque une valeur est entré dans la barre de recherche.
            $(champRecherche).keyup(function () {
                typewatch(function () {
                    // Pour chaque résultat.
                    $(selecteur + ' option').each(function () {
                        // Si il ne correspond pas à la recherche...
                        if ($(this).text().search(new RegExp($(champRecherche).val(), 'i')) === -1) {
                            $(this).hide(); // ...On le cache.
                        }
                        // Si il correspond à la recherche.
                        else {
                            // On le montre et on lui donne son nom comme attribut 'title'.
                            $(this).show();
                            $(this).attr('title', $(this).text());
                        }
                    });
                    // On applique une couleur différente au résultat pair et impair.
                    $(selecteur + ' option:visible:odd').css('background', 'SeaShell');
                    $(selecteur + ' option:visible:even').css('background', 'white');
                }, 500);
            });
        }
    </script>

{% endblock %}
